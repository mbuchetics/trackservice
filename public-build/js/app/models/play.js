define(["order!libs.jquery","order!libs.underscore","order!libs.backbone","utils"],function(a,b,c,d){var e=c.Model.extend({like:function(){d.likeSong(this.get("songId"),CurrentUser.get("id"))},updateTime:function(){var a=this.get("originalTime");this.set({time:d.getTimeStr(a),isRecent:d.isRecentTime(a)})}},{create:function(a){var b=new e,c=new Date(a.time);return b.set({songId:a.song_id,time:d.getTimeStr(c),originalTime:c,artist:a.artist,title:a.title,source:a.source,isRecent:d.isRecentTime(c)}),a.spotify&&b.set({spotify:a.spotify}),b}}),f=c.Collection.extend({model:e,fetchFromServer:function(c){var d=this;a.getJSON("api/plays",{count:c},function(a){d.reset(b.map(a,e.create))})},fetchMoreFromServer:function(c){var d=this,f=d.last().get("originalTime").add({seconds:-1});a.getJSON("api/plays",{until:f.toString(),count:c},function(a){d.add(b.map(a,e.create))})},updateFromServer:function(c){var d=this,f=d.first().get("originalTime").add({seconds:1});a.getJSON("api/plays",{since:f.toString(),count:c},function(a){a.reverse(),b.each(a,function(a){d.add(e.create(a),{at:0}),d.remove(d.last())})})},updateTimes:function(){this.each(function(a){a.updateTime()})}});return{Play:e,Plays:f}})